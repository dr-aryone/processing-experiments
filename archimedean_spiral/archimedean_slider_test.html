<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Ken's Processing Experiments</title>
  <link rel='stylesheet' href='//fonts.googleapis.com/css?family=Swanky+and+Moo+Moo|Open+Sans+Condensed:300|Open+Sans' />
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css" />
	<link rel="stylesheet" href="https://code.jquery.com/ui/1.12.0-rc.1/themes/smoothness/jquery-ui.css">
	<style>
		#sliders-container {
			margin-top: 2em;
			margin-bottom: 2em;
		}
		.col-sm-12 {
			margin-top: .25em;
			margin-bottom: .25em;
		}
	</style>
</head>
<body>
	
	<div class="container" id="sliders-container">
		<div class="row">
			<div class="col-sm-12"><h3>Formula: r = a + b&theta;</h3></div>
		</div>
		<div class="row">
			<div class="col-sm-1">a:</div>
			<div class="col-sm-2">
				<input type="number" min="0" max="10" step="0.01" class="slider-input" id="a-input" />
			</div>
			<div class="col-sm-9" id="a"></div>
		</div>
		<div class="row">
			<div class="col-sm-1">b:</div>
        <div class="col-sm-2">
					<input type="number" min="0.01" max="10" step="0.01" class="slider-input" id="b-input" />
				</div>
        <div class="col-sm-9" id="b"></div>
		</div>
		<div class="row">
			<div class="col-sm-1">step:</div>
        <div class="col-sm-2">
					<input type="number" min="0.01" max="10" step="0.01" class="slider-input" id="step-input" />
				</div>
        <div class="col-sm-9" id="step"></div>
		</div>
	</div>
	
	<div class="center-block" id="canvas-container">
		<canvas id="sketch-canvas"></canvas>
	</div>
	
  <!-- javascript below -->
  <script src="//code.jquery.com/jquery-2.1.3.min.js" type="text/javascript"></script>
  <script src="//code.jquery.com/ui/1.12.0-rc.1/jquery-ui.min.js" integrity="sha256-mFypf4R+nyQVTrc8dBd0DKddGB5AedThU73sLmLWdc0=" crossorigin="anonymous"></script>
  <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js" type="text/javascript"></script>
  <script src="lib/processing.js"></script> 
	<script src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
	<script src="lib/ASCIIMathML.js"></script>
  <script type="text/javascript">
		function throttle(fn, threshhold, scope) {
			threshhold || (threshhold = 250);
			var last,
					deferTimer;
			return function () {
				var context = scope || this,
						now = +new Date,
						args = arguments;
				if (last && now < last + threshhold) {
					clearTimeout(deferTimer);
					deferTimer = setTimeout(function () {
						last = now;
						fn.apply(context, args);
					}, threshhold);
				} else {
					last = now;
					fn.apply(context, args);
				}
			};
		}
		
		
    var canvas = document.getElementById('sketch-canvas'),
				processing_inst;
		$.get('archimedean_spiral.pde').then(function(data) {
			var compiledSketch = Processing.compile(data);
			console.log(canvas);
			processing_inst = new Processing(canvas, compiledSketch);
			document.getElementById('canvas-container').style.width = canvas.width+"px";
				
			$('input.slider-input').change(throttle(function() {
				$('#a').slider('value', $('#a-input').val());
				$('#b').slider('value', $('#b-input').val());
				$('#step').slider('value', $('#step-input').val());
				redrawSpiral();
				//redrawSpiral_throttled();
			},25));
			$('#a, #b, #step').slider({
				min: 0,
				max: 10,
				step: .01,
				slide: throttle(spiral,25)
			});
			$('#a').slider('value', 0);
			$('#b').slider('value', Math.PI);
			$('#step').slider('value', Math.PI/2-.05);
			
			spiral();
		});

		function spiral() {
			console.log('saw a change');
			var a = $('#a').slider('value'),
					b = $('#b').slider('value'),
					step = $('#step').slider('value');
			console.log(a, b, step);
			$('#a-input').val(a);
			$('#b-input').val(b);
			$('#step-input').val(step);
			
			redrawSpiral();
			//redrawSpiral_throttled();
		}
		function redrawSpiral() {
			var a = $('#a').slider('value'),
					b = $('#b').slider('value'),
					step = $('#step').slider('value');
			processing_inst.redrawSpiral(a, b, step);
		}
		var redrawSpiral_throttled = throttle(redrawSpiral, 25);
		
	</script>
</body>
</html>

